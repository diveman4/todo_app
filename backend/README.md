# Todo App Backend API

## API概要
TodoアプリケーションのバックエンドAPIサーバーです。フロントエンドから送られてくるリクエストを受け取り、データベースに保存されているTodoアイテムの作成・取得・更新・削除を行うREST API

主な機能：
- Todoアイテムの一覧取得（キーワード検索対応）
- 特定のTodoアイテムの取得
- 新しいTodoアイテムの作成
- 既存のTodoアイテムの更新（完了状態の変更、内容の編集など）
- Todoアイテムの削除
- OpenAPI/Swagger UIによるAPI仕様の確認

## 使用技術・ライブラリ一覧とその選定理由

### コア技術

#### **Hono** (v4.11.4)
- **選定理由**: APIサーバとして使用。軽量で高速なWebフレームワークであること。また、TypeScriptとの相性が良く、型安全性を保ちながら開発できる為選定。

#### **Prisma** (v6.19.2)
- **選定理由**: 型安全なORMツールであること。データベースのスキーマを定義すると、自動的にTypeScriptの型が生成され、コンパイル時にエラーを検出できる為選定。

#### **TypeScript** (v5.8.3)
- **選定理由**: フロントエンドがTypeScript推奨であったため、技術スタックを統一するためバックエンドもTypeScriptを選択。また、コードの可読性と保守性が良いため選定。

#### **PostgreSQL**
- **選定理由**: 多くの企業で採用されているデータベースである為。普段業務で使っていないため、せっかくの機会に選定。

### 開発ツール

#### **tsx** (v4.7.1)
- **選定理由**: 開発中にいちいちコンパイルする必要がなく、ホットリロードに対応している為選定。

#### **@hono/node-server** (v1.19.9)
- **選定理由**: HonoアプリケーションをNode.jsサーバーとして動作させることができる。honoと同梱のため。

## 環境構築手順

プロジェクトルートの[README.md](../README.md)を参照してください。

### バックエンドサーバー
- バックエンドAPIサーバーは http://localhost:3001 で起動します（docker-compose.yml参照）


## APIエンドポイント

すべてのエンドポイントは `http://localhost:3001` をベースURLとします。

### 1. Todo一覧取得

**GET** `/todos`

- **説明**: 保存されているすべてのTodoアイテムを取得します。作成日時の新しい順に並びます。キーワード検索に対応しています。
- **クエリパラメータ**:
  - `keyword` (任意): タイトルまたは説明文に含まれるキーワードで検索（大文字小文字を区別しない）
- **リクエスト例**: 
  - すべて取得: `GET /todos`
  - キーワード検索: `GET /todos?keyword=買い物`
- **レスポンス例**:
  ```json
  [
    {
      "id": 1,
      "title": "買い物に行く",
      "description": "牛乳とパンを買う",
      "completed": false,
      "dueDate": "2024-01-20T00:00:00.000Z",
      "priority": "MEDIUM",
      "createdAt": "2024-01-15T10:00:00.000Z",
      "updatedAt": "2024-01-15T10:00:00.000Z"
    }
  ]
  ```

### 2. 特定のTodo取得

**GET** `/todos/:id`

- **説明**: 指定されたIDのTodoアイテムを取得します。
- **パスパラメータ**: `id` (TodoアイテムのID)
- **レスポンス例**:
  ```json
  {
    "id": 1,
    "title": "買い物に行く",
    "description": "牛乳とパンを買う",
    "completed": false,
    "dueDate": "2024-01-20T00:00:00.000Z",
    "priority": "MEDIUM",
    "createdAt": "2024-01-15T10:00:00.000Z",
    "updatedAt": "2024-01-15T10:00:00.000Z"
  }
  ```
- **エラー**: 指定されたIDが存在しない場合、404エラーを返します

### 3. Todo作成

**POST** `/todos`

- **説明**: 新しいTodoアイテムを作成します。
- **リクエストボディ**:
  ```json
  {
    "title": "買い物に行く",          // 必須
    "description": "牛乳とパンを買う",  // 任意
    "dueDate": "2024-01-20",          // 任意（ISO 8601形式の日付文字列）
    "priority": "HIGH"                // 任意（HIGH, MEDIUM, LOW）。未指定の場合はMEDIUM
  }
  ```
- **レスポンス**: 作成されたTodoアイテム（ステータスコード: 201）
- **エラー**: `title`が未指定の場合、400エラーを返します

### 4. Todo更新

**PUT** `/todos/:id`

- **説明**: 指定されたIDのTodoアイテムを更新します。部分更新に対応しており、指定したフィールドのみ更新されます。
- **パスパラメータ**: `id` (TodoアイテムのID)
- **リクエストボディ例**:
  ```json
  {
    "title": "買い物に行く（更新）",     // 任意
    "completed": true,                  // 任意
    "description": "更新された説明",     // 任意
    "dueDate": "2024-01-25",           // 任意（ISO 8601形式の日付文字列、nullでクリア可能）
    "priority": "LOW"                   // 任意（HIGH, MEDIUM, LOW）
  }
  ```
- **レスポンス**: 更新されたTodoアイテム
- **エラー**: 指定されたIDが存在しない場合、404エラーを返します

### 5. Todo削除

**DELETE** `/todos/:id`

- **説明**: 指定されたIDのTodoアイテムを削除します。
- **パスパラメータ**: `id` (TodoアイテムのID)
- **レスポンス**:
  ```json
  {
    "message": "Deleted successfully"
  }
  ```
- **エラー**: 指定されたIDが存在しない場合、404エラーを返します

### 6. OpenAPI仕様書取得

**GET** `/docs/openapi.json`

- **説明**: APIのOpenAPI仕様書（JSON形式）を取得します。
- **レスポンス**: OpenAPI 3.0形式のJSON

### 7. Swagger UI

**GET** `/docs`

- **説明**: Swagger UIによるAPI仕様書のブラウザ表示ページです。
- **アクセス**: http://localhost:3001/docs にブラウザでアクセスすると、インタラクティブなAPI仕様書が表示されます。

## 工夫した点・アピールポイント

### 1. **型安全性の徹底**
- PrismaとTypeScriptを組み合わせることで、データベースのスキーマとコードの型が常に一致。これにより、コンパイル時にエラーを発見でき、実行時のエラーを大幅に逓減。

### 2. **エラーハンドリング**
- すべてのエンドポイントでtry-catch文を使用し、エラーが発生した場合に適切なHTTPステータスコード（400, 404, 500など）とエラーメッセージを返すよう設定。これにより、フロントエンド側でエラーを処理可能。

### 3. **CORS設定**
- フロントエンドとバックエンドが異なるポートで動作することを考慮し、CORS（Cross-Origin Resource Sharing）を有効化しています。これにより、ブラウザのセキュリティ制限を回避。
- 環境変数 `ALLOWED_ORIGINS` を設定することで、許可するオリジンを制限できます（カンマ区切りで複数指定可能）。未設定の場合は全てのオリジンを許可（開発環境用）。

### 4. **デフォルト値の設定**
- 新規作成時に`priority`が指定されていない場合は、自動的に`MEDIUM`が設定されるなど、ユーザビリティを考慮したデフォルト値の設定。

### 5. **Docker環境の整備**
- Docker Composeを使用することで、データベースとAPIサーバーを簡単に起動でき、開発環境の構築が容易。

### 6. **経験の少ない言語、フレームワークの選択**
- 通常業務において言語はPython、DBではMySQLなどを使用していた。知見蓄積のため、今回は敢えてそれらを使わずに構築。

### 7. **OpenAPI/Swagger UIの実装**
- API仕様書を自動生成し、Swagger UIで視覚的に確認できるようにしました。これにより、APIの動作をブラウザ上で簡単にテスト可能。

### 8. **キーワード検索機能**
- Todo一覧取得時に、タイトルと説明文を対象としたキーワード検索に対応。大文字小文字を区別しない検索により、ユーザビリティを向上。


## オプション課題の導入状況（導入したものを◯で記載）

### 1. 認証機能
- ユーザー登録・ログイン・ログアウトAPI
- JWT または セッションによる認証
- TODOをユーザーごとに管理

### 2. TODOの詳細機能
- ◯期限日（`dueDate`）の追加
- ◯優先度（`priority`: high/medium/low）の追加
- ◯説明文（`description`）の追加

### 3. 高度なクエリ機能
- ソート機能（`sort`, `order` パラメータ）
- ◯キーワード検索（`q` パラメータ）
- 期限日での絞り込み

### 4. その他
- レートリミット実装
- キャッシュ機能（Redis等）
- ヘルスチェックエンドポイント（`/health`）
- ロギング（構造化ログ）
- ◯CI/CD パイプライン構築（GitHub Actions等）

### 5. APIドキュメント
- ◯OpenAPI (Swagger) 形式での仕様書
- ◯Swagger UI での閲覧対応

### 6. テストコード
- ユニットテスト
- 統合テスト（APIテスト）

### 7. その他
- Postman Collection または HTTPファイル（リクエスト例）
- ◯ER図（データベース設計図）